<!doctype html>
<meta charset="utf-8" />
<title>overlay</title>
<style>
  :root { --ang: 0deg; --scale: 1; }
  html, body { margin: 0; background: transparent; }
  /* Drag region (toolbar) */
  #bar {
    -webkit-app-region: drag;
    position: fixed; left: 0; right: 0; top: 0; height: 34px;
    display: flex; align-items: center; gap: 8px;
    padding: 4px 8px; color: #fff; font: 12px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background: rgba(0,0,0,.35);
    border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;
    backdrop-filter: blur(6px);
  }
  #bar button {
    -webkit-app-region: no-drag;
    appearance: none; border: 0; border-radius: 8px; padding: 4px 8px; cursor: pointer;
    background: rgba(255,255,255,.15); color: #fff; font-weight: 600;
  }
  #wrap {
    position: fixed; inset: 0; display: grid; place-items: center; padding-top: 34px;
  }
  #fig {
    transform: rotate(var(--ang)) scale(var(--scale));
    transform-origin: center center;
    pointer-events: auto;
    user-select: none;
  }
  #fig img { display:block; max-width: 90vw; max-height: 85vh; }
</style>
<body>
  <div id="bar">
    <div style="opacity:.8">Overlay</div>
    <div style="margin-left:auto"></div>
    <button id="smaller" title="Smaller">–</button>
    <button id="bigger" title="Bigger">+</button>
    <button id="rotL" title="Rotate left">⟲</button>
    <button id="rotR" title="Rotate right">⟳</button>
    <button id="close" title="Close">✕</button>
  </div>
  <div id="wrap">
    <figure id="fig"><img id="img" alt=""></figure>
  </div>
  <script>
    const $ = (s) => document.querySelector(s);

    // image from main via hash
    const src = decodeURIComponent(location.hash.slice(1));
    const img = $('#img');
    if (src) img.src = src;

    // controls
    const root = document.documentElement;
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

    $('#bigger').addEventListener('click', () => {
      const s = parseFloat(getComputedStyle(root).getPropertyValue('--scale')) || 1;
      root.style.setProperty('--scale', String(clamp(s * 1.1, 0.1, 10)));
    });
    $('#smaller').addEventListener('click', () => {
      const s = parseFloat(getComputedStyle(root).getPropertyValue('--scale')) || 1;
      root.style.setProperty('--scale', String(clamp(s / 1.1, 0.1, 10)));
    });
    $('#rotL').addEventListener('click', () => {
      const a = parseFloat(getComputedStyle(root).getPropertyValue('--ang')) || 0;
      root.style.setProperty('--ang', (a - 10) + 'deg');
    });
    $('#rotR').addEventListener('click', () => {
      const a = parseFloat(getComputedStyle(root).getPropertyValue('--ang')) || 0;
      root.style.setProperty('--ang', (a + 10) + 'deg');
    });
    $('#close').addEventListener('click', () => window.overlayAPI?.closeSelf?.());

    // keyboard: +/- rotate with [ and ]
    window.addEventListener('keydown', (e) => {
      if (e.key === '+') $('#bigger').click();
      if (e.key === '=') $('#bigger').click();
      if (e.key === '-') $('#smaller').click();
      if (e.key === '[') $('#rotL').click();
      if (e.key === ']') $('#rotR').click();
      if (e.key === 'Escape') $('#close').click();
    });

    // wheel to zoom
    window.addEventListener('wheel', (e) => {
      if (e.ctrlKey) return; // let OS-zoom alone
      e.preventDefault();
      (e.deltaY < 0 ? $('#bigger') : $('#smaller')).click();
    }, { passive: false });
  </script>
</body>
