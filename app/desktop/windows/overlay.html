<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>icon – overlay</title>
    <style>
      html, body { margin: 0; height: 100%; background: transparent; }
      .titlebar {
        -webkit-app-region: drag;
        position: absolute; inset: 0 0 auto 0; height: 28px;
        background: transparent;
      }
      .no-drag { -webkit-app-region: no-drag; }

      .wrap { position: absolute; inset: 0; display: grid; place-items: center; user-select: none; }
      .img {
        will-change: transform;
        transform-origin: center center;
        max-width: 95vmin; max-height: 95vmin;
        pointer-events: none; /* let window drag everywhere except the buttons */
      }

      .buttons { position: absolute; right: 8px; top: 8px; display: flex; gap: 6px; }
      button{
        border:0;border-radius:10px;padding:6px 10px;
        font:12px/1.1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        background:rgba(0,0,0,.6);color:#fff;cursor:pointer;
      }
      button:hover{ background: rgba(0,0,0,.8); }
    </style>
  </head>
  <body>
    <div class="titlebar"></div>

    <div class="wrap">
      <img id="img" class="img" alt="overlay" />
      <div class="buttons no-drag">
        <button id="rotL" title="Rotate -90°">⟲</button>
        <button id="rotR" title="Rotate +90°">⟳</button>
        <button id="close" title="Close">✕</button>
      </div>
    </div>

    <script>
      const $ = (s) => document.querySelector(s);
      const { ipcRenderer } = window.electron; // provided by overlay-preload.js

      const imgEl = $('#img');
      let rotation = 0;
      let scale = 1;

      // Load image URL from hash
      try {
        const src = decodeURIComponent(location.hash.slice(1));
        if (src) imgEl.src = src;
      } catch {}

      // Rotate buttons
      $('#rotL').addEventListener('click', () => { rotation -= 90; apply(); });
      $('#rotR').addEventListener('click', () => { rotation += 90; apply(); });

      // Close just this overlay
      $('#close').addEventListener('click', () => { ipcRenderer.invoke('overlay/closeSelf'); });

      // Ctrl/⌘ + MouseWheel to resize
      window.addEventListener('wheel', (e) => {
        if (e.ctrlKey || e.metaKey) {
          e.preventDefault();
          scale += e.deltaY * -0.001;
          scale = Math.max(0.1, Math.min(5, scale));
          apply();
        }
      }, { passive:false });

      // Ctrl/⌘+R rotate clockwise (prevent refresh)
      window.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'r') {
          e.preventDefault();
          rotation += 90; apply();
        }
      });

      function apply() {
        imgEl.style.transform = `rotate(${rotation}deg) scale(${scale})`;
      }
    </script>
  </body>
</html>
