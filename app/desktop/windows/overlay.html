<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>overlay</title>
  <style>
    html, body { margin:0; height:100%; background: transparent; }
    /* Make the whole window draggable unless explicitly opted-out */
    .drag { -webkit-app-region: drag; position: absolute; inset: 0; }
    .chrome { position: absolute; top: 8px; right: 8px; display: flex; gap: 6px; -webkit-app-region: no-drag; }
    .btn {
      border:0; padding:6px 8px; border-radius:8px; font:12px/1 ui-sans-serif, system-ui;
      color:#fff; background:rgba(0,0,0,.55); cursor:pointer;
    }
    #wrap { position:absolute; inset:0; display:grid; place-items:center; -webkit-app-region: no-drag; }
    #img { max-width:100%; max-height:100%; transform-origin:center center; image-rendering: auto; }
  </style>
</head>
<body>
  <div class="drag"></div>
  <div class="chrome">
    <button id="smaller" class="btn" title="Alt+-">–</button>
    <button id="bigger" class="btn" title="Alt+=">+</button>
    <button id="rotate" class="btn" title="Alt+R">⟳</button>
    <button id="close"  class="btn" title="Close">✕</button>
  </div>
  <div id="wrap"><img id="img" alt="overlay"/></div>

  <script>
    const params = decodeURIComponent(location.hash.slice(1) || '');
    const src = params || '';
    const img = document.getElementById('img');
    img.src = src;

    const stateKey = 'overlay:state:' + (src || 'unknown');
    const state = (() => {
      try { return JSON.parse(localStorage.getItem(stateKey) || '{"scale":1,"rot":0}'); }
      catch { return { scale:1, rot:0 }; }
    })();

    function apply() {
      img.style.transform = `scale(${state.scale}) rotate(${state.rot}deg)`;
      try { localStorage.setItem(stateKey, JSON.stringify(state)); } catch {}
    }
    apply();

    document.getElementById('close')?.addEventListener('click', () => window.electronAPI?.closeSelf?.());
    document.getElementById('rotate')?.addEventListener('click', () => { state.rot = (state.rot + 90) % 360; apply(); });
    document.getElementById('bigger')?.addEventListener('click', () => { state.scale = Math.min(5, state.scale + 0.1); apply(); });
    document.getElementById('smaller')?.addEventListener('click', () => { state.scale = Math.max(0.1, state.scale - 0.1); apply(); });

    // Hotkeys
    window.addEventListener('keydown', (e) => {
      if (!e.altKey) return;
      if (e.code === 'KeyR') { state.rot = (state.rot + 90) % 360; apply(); }
      if (e.key === '=' || e.code === 'Equal') { state.scale = Math.min(5, state.scale + 0.1); apply(); }
      if (e.key === '-' || e.code === 'Minus') { state.scale = Math.max(0.1, state.scale - 0.1); apply(); }
    });
  </script>
</body>
</html>
