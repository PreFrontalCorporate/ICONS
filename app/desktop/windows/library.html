<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>icon – library</title>
    <style>
      html, body { height: 100%; margin: 0; background: #111; }
      #libview { position: fixed; inset: 0; border: 0; }
      #hud {
        position: fixed; right: 16px; bottom: 16px; z-index: 10;
        background: rgba(0,0,0,.8); color: #fff; padding: 12px 14px; border-radius: 12px;
        font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        box-shadow: 0 10px 24px rgba(0,0,0,.35); max-width: 320px;
      }
      #hud button { appearance:none; border:0; border-radius:10px; padding:6px 10px; background:#ef4444; color:#fff; font-weight:600; cursor:pointer; }
      #count { font-variant-numeric: tabular-nums; }
    </style>
  </head>
  <body>
    <!-- Hosted Library inside a webview; preload injects a click relay -->
    <webview
      id="libview"
      src="https://icon-web-two.vercel.app/library"
      preload="./webview-preload.js"
      allowpopups
      partition="persist:iconlib">
    </webview>

    <!-- Minimal HUD -->
    <div id="hud" role="status" aria-live="polite">
      <strong>Overlays</strong> <span id="count">0</span>
      <button id="clear">Clear</button>
      <div style="opacity:.7;margin-top:6px;font-size:12px">
        Tip: Ctrl/⌘+Shift+O or Ctrl/⌘+Shift+0 toggles; Ctrl/⌘+Shift+Backspace clears.
      </div>
    </div>

    <script>
      // talk to the app via preload compat bridge
      const addSticker = (p) => window.icon?.addSticker?.(p);
      const clearOverlays = () => window.icon?.clearOverlays?.();
      window.icon?.onOverlayCount?.((n)=>{ const el=document.getElementById('count'); if(el) el.textContent=String(n); });
      document.getElementById('clear')?.addEventListener('click', clearOverlays);

      const libview = document.getElementById('libview');
      libview.addEventListener('ipc-message', (ev) => {
        if (ev.channel === 'icon:webview-sticker' && ev.args && ev.args[0]) {
          addSticker(ev.args[0]); // { src }
        }
      });
      libview.addEventListener('dom-ready', () => { libview.focus(); console.debug('[library] webview dom-ready'); });
    </script>
  </body>
</html>
