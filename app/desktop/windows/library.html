<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>icon â€“ library</title>
<style>
  html,body{margin:0;height:100%}
  body{background:#151515;color:#eee}
  /* Make the webview fill the window */
  #libview{
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    border: 0; display: block;
  }
</style>
</head>
<body>

<!-- Persisted session so login sticks; preload runs inside the guest page -->
<webview
  id="libview"
  src="https://icon-web-two.vercel.app/library"
  partition="persist:icon-app"
  allowpopups
  preload="./webview-preload.js">
</webview>

<script>
  // Host-side bridge: receive events from the webview preload
  const lib = document.getElementById('libview');
  lib.addEventListener('ipc-message', (ev) => {
    try {
      if (ev.channel === 'pin-sticker') {
        const { url } = (ev.args && ev.args[0]) || {};
        if (url && window.api?.overlays?.pinFromUrl) window.api.overlays.pinFromUrl(url);
      }
      if (ev.channel === 'open-external') {
        const { url } = (ev.args && ev.args[0]) || {};
        if (url && window.api?.openExternal) window.api.openExternal(url);
      }
    } catch {}
  });
</script>
</body>
</html>
