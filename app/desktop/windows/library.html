<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>icon â€“ library</title>
    <style>
      html, body { height: 100%; margin: 0; background: #111; }
      #libview { position: fixed; inset: 0; border: 0; }
    </style>
  </head>
  <body>
    <!-- IMPORTANT: preload is our fixed bridge above -->
    <webview
      id="libview"
      src="https://icon-web-two.vercel.app/library"
      preload="./webview-preload.js"
      allowpopups
      partition="persist:iconlib">
    </webview>

    <script>
      const libview = document.getElementById('libview');

      // Ensure we only attach this listener once.
      if (!window.libraryListenerAttached) {
        // The host renderer (this page) listens for IPC messages from the <webview> guest.
        // The webview's own preload script sends this message.
        libview.addEventListener('ipc-message', (event) => {
          // GOAL:webview.single_ipc_message
          if (event.channel === 'icon:webview-sticker' && event.args?.[0]?.src) {
            // The main window's preload script (preload.ts) exposes `window.icon.addSticker`.
            window.icon?.addSticker?.({ src: event.args[0].src });
          }
        });
        window.libraryListenerAttached = true;
      }


      libview.addEventListener('dom-ready', () => {
        // The webview is ready, give it focus.
        libview.focus();
      });
    </script>
  </body>
</html>
